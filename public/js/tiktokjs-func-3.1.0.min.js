/**
 * Â© Copyright 2023.10 - Mochino
 * Jquery page handler (tiktokjs-func-3.1.0.js)
 * @github.com/motebaya
 */
const setTheme=theme=>{console.log(`changed theme to: ${theme}`);const toggle=$("#themes").find("i");if(toggle.hasClass("bi-brightness-high-fill")&&theme==="light"){toggle.removeClass("bi-brightness-high-fill").addClass("bi-moon-stars-fill")}else{toggle.removeClass("bi-moon-stars-fill").addClass("bi-brightness-high-fill")}$("html").attr("data-bs-theme",theme);localStorage.setItem("theme",theme)};const getTheme=()=>{let storedTheme=localStorage.getItem("theme");if(storedTheme){return storedTheme}return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"};const svgCheck=()=>{const svg=$(".svg-crying");const currentTheme=getTheme();const currentFilled=svg.data("filled");if(currentFilled===currentTheme){svg.attr("src",currentTheme==="dark"?svg.attr("src").replace(/-dark/g,""):svg.attr("src").replace(/\.svg/g,"-dark.svg"));svg.data("filled",currentFilled==="dark"?"light":"dark")}};$(window).on("load",()=>{setTheme(getTheme());svgCheck()});$(function(){function checkCache(elTarget){if(elTarget.css("display")==="none"){var cachedResult=localStorage.getItem("cachedResult");var tikwmUsername=localStorage.getItem("tikwmUsername");if(cachedResult){$(`#${tikwmUsername!==null?"tikwm-result":"content"}`).html(decodeURIComponent(cachedResult)).fadeIn("slow");svgCheck();$('div[class="toast-body"]').html(tikwmUsername!==null?`loaded tikwm userfeed @${tikwmUsername} from cache...`:"loaded before result from cache...");$(".liveToast").toast("show")}}}checkCache($("#content"));checkCache($("#tikwm-result"));function getUserFeed(data){$.ajax({url:`/api/v1/tikwm`,data:data,method:"POST",dataType:"json"}).done(res=>{if(res.status==="success"){if(res.videos.length!==0){if($("#tikwm-result").css("display")==="none"){$("#tikwm-result").fadeIn("slow")}for(let item of res.videos){$("#tikwm-images").append(`<div class="col-md-3"><a href="/api/fdownload?token=${item.thumbnailRedirect}&fname=${item.video_id}_thumbnail" target="_blank" rel="noopener noreferrer"><img src="${item.thumbnail}" class="img-thumbnail w-20" alt="video thumbnail" style="max-width:70%"/></a><div class="mt2"><p class="text-secondary">${item.video_id}</p><div class="mb-2 mt-2"><a href="/api/fdownload?token=${item.urlRedirect}&fname=${item.video_id}_videos" class="btn btn-outline-secondary btn-sm mb-2 mt-2" target="_blank" rel="noopener noreferrer"><i class="bi-download me-1"></i>Download MP4</a></div><div class="mb-2 mt-2"><a href="/api/fdownload?token=${item.music.urlRedirect}&fname=${item.video_id}_music" class="btn btn-outline-success btn-sm mb-2 mt-2" target="_blank" rel="noopener noreferrer"><i class="bi-file-earmark-music me-1"></i>Music MP3</a></div></div></div>`)}}if(res.hasMore){localStorage.setItem("tikwmCursor",res.cursor);if($("#btn-tikwm-more").length===0){$("#tikwm-result").find(".card-body").append(`<div class="text-center"><button class="btn btn-sm btn-outline-primary mb-2 mt-2" id="btn-tikwm-more"><i class="bi-arrow-repeat me-1"></i>More Page</button></div>`);}}else{if($("#btn-tikwm-more").length!==0){$("#btn-tikwm-more").remove()}}}}).always(()=>{$('form[method="POST"]')[0].reset();$("#btn-go").html(`<i class="bi-send me-2"></i>Go`).prop("disabled",false);if($("#btn-tikwm-more").length!==0){$("#btn-tikwm-more").html(`<i class="bi-arrow-repeat me-1"></i>More Page`).prop("disabled",false)}localStorage.setItem("tikwmUsername",data.username);localStorage.setItem("cachedResult",encodeURIComponent($("#tikwm-result").html()))})}$(document).on("click","#btn-tikwm-more",function(){$(this).prop("disabled",true).html(`<span class="spinner-border spinner-border-sm" aria-hidden="true"></span><span role="status" class="ms-2">Fetching..</span>`);getUserFeed({username:localStorage.getItem("tikwmUsername"),cursor:localStorage.getItem("tikwmCursor")})});$('select[name="server"]').on("change",function(){if(["savetik","snaptik","ssstik","musicaldown"].includes($(this).val())){$("#warning-info").fadeIn("slow")}else{$("#warning-info").fadeOut("slow")}});$('form[method="POST"]').on("submit",function(e){e.preventDefault();const server=$('select[name="server"]').val();if(server==="default"){$('div[class="toast-body"]').html("please fill form correctly!");$(".liveToast").toast("show")}else{$("#btn-go").prop("disabled",true).html(`<span class="spinner-border spinner-border-sm" aria-hidden="true"></span><span role="status"> Processing...</span>`);if($("#content").css("display")!=="none"){$("#content").fadeOut("slow")}if($("#tikwm-result").css("display")!=="none"){$("#tikwm-result").fadeOut("slow")}var formdata=$(this).serialize();var username=new URLSearchParams(formdata).get("url");if(server.toLowerCase()==="tikwm"&&new RegExp(usernameRegex).test(username)){if($("#tikwm-images").length!==0){$("#tikwm-images").html("")}if($("#tikwm-result").find("script").length===0){$("#tikwm-result").append(`<script src="/js/content.min.js"></script>`)}if($("#content").find("script").length!==0){$("#content").find("script").remove()}getUserFeed({username:username})}else{if($("#tikwm-result").find("script").length!==0){$("#tikwm-result").find("script").remove()}localStorage.removeItem("tikwmUsername");$.ajax({url:`/api/v1/${server}`,data:formdata,method:"POST",dataType:"json"}).done(res=>{if(res.status==="success"){$('form[method="POST"]')[0].reset();localStorage.setItem("cachedResult",res.data);$("#content").html(decodeURIComponent(res.data)).fadeIn("slow");svgCheck()}}).fail(err=>{if(err.status===500&&err.responseJSON.status==="failed"){localStorage.setItem("cachedResult",err.responseJSON.data);$("#content").html(decodeURIComponent(err.responseJSON.data)).fadeIn("slow");svgCheck()}}).always(()=>{$("#btn-go").html(`<i class="bi-send me-2"></i>Go`).prop("disabled",false)})}}});$("#themes").on("click",()=>{setTheme(getTheme()==="dark"?"light":"dark");svgCheck()});$(window).on("scroll",function(){if($(this).scrollTop()>300){$(".back-to-top").fadeIn()}else{$(".back-to-top").fadeOut()}});const placeholder=["https://www.tiktok.com/@usera123/video/726207387766565755467","https://vt.tiktok.com/FDSR9juhf87/","@username","username"];let index=0;setInterval(()=>{$("input[id='url']").attr("placeholder",placeholder[index]);index=(index+1)%placeholder.length},1500)});